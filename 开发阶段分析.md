# ä¿®ä»™æ¸¸æˆå¼€å‘é˜¶æ®µåˆ†æ

## é¡¹ç›®æ¦‚è¿°

åŸºäºdemoæ–‡æ¡£åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥ä¿®ä»™ä¸ºä¸»é¢˜çš„è§’è‰²æ‰®æ¼”æ¸¸æˆï¼ŒåŒ…å«å®Œæ•´çš„ä¿®ç‚¼ä½“ç³»ã€å®—é—¨ç³»ç»Ÿã€æ­¦å™¨è£…å¤‡ã€ç‰©å“ç‚¼åˆ¶ç­‰æ ¸å¿ƒç©æ³•ã€‚é¡¹ç›®é‡‡ç”¨React + TypeScriptæŠ€æœ¯æ ˆï¼Œæ•°æ®å­˜å‚¨åœ¨JSONæ–‡ä»¶ä¸­ã€‚

## åŠŸèƒ½æ¨¡å—åˆ†æ

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **äººç‰©å±æ€§ç³»ç»Ÿ**
   - åŸºç¡€å±æ€§ï¼šäº”è¡Œäº²å’Œåº¦ã€ç­‰çº§å¢ƒç•Œã€ä¿®ç‚¼å€¼ã€çµé­‚å¼ºåº¦ç­‰
   - è¡ç”Ÿå±æ€§ï¼šæˆ˜æ–—å€¾å‘ã€ç‰¹æ®Šä½“è´¨ã€ä¿®ç‚¼é€Ÿåº¦ç­‰
   - å¤´è¡”ç³»ç»Ÿï¼šå®—é—¨å¤´è¡”ã€ä¸–ç•Œå¤´è¡”
   - è´§å¸ç³»ç»Ÿï¼šåŸºç¡€è´§å¸ã€çµçŸ³ã€ç‰¹åˆ«å…‘æ¢è´§å¸

2. **ä¿®ç‚¼ä½“ç³»**
   - å¢ƒç•Œåˆ’åˆ†ï¼šå‡¡äººé˜¶æ®µâ†’ä¿®å£«é˜¶æ®µâ†’ä»™ç¥é˜¶æ®µ
   - çªç ´æœºåˆ¶ï¼šæˆåŠŸç‡è®¡ç®—ã€å¤±è´¥æƒ©ç½š
   - åŠŸæ³•ç³»ç»Ÿï¼šå¿ƒæ³•ã€åŠŸæ³•ã€æ­¦æŠ€ã€ç§˜æœ¯/ç¦æœ¯

3. **å®—é—¨ç³»ç»Ÿ**
   - å®—é—¨ç­‰çº§ã€æˆå‘˜ç®¡ç†
   - å®—é—¨èµ„æºã€è´¡çŒ®ç‚¹ç³»ç»Ÿ
   - å®—é—¨ä»»åŠ¡ã€æƒé™ç®¡ç†

4. **è£…å¤‡ç³»ç»Ÿ**
   - æ­¦å™¨å±æ€§è®¾è®¡
   - ç­‰çº§é€‚é…è§„åˆ™
   - è£…å¤‡å¼ºåŒ–æœºåˆ¶

5. **ç‰©å“ç³»ç»Ÿ**
   - æ¶ˆè€—å“ï¼šä¸¹è¯ã€çµæœç­‰
   - ç‰¹æ®Šç‰©å“ï¼šææ–™ã€å®ç‰©ç­‰
   - ç‚¼ä¸¹ç³»ç»Ÿ

6. **è”åŠ¨æœºåˆ¶**
   - äººç‰©-æ­¦å™¨-åŠŸæ³•è”åŠ¨
   - æˆ˜åŠ›ä¸ç©æ³•è”åŠ¨
   - åèª‰å€¼ä¸äº’åŠ¨è”åŠ¨

## å¼€å‘é˜¶æ®µè§„åˆ’

### Stage One: æ ¸å¿ƒä¿®ä»™åŠŸèƒ½å®ç° (å½“å‰é˜¶æ®µ)

**ç›®æ ‡**: å®ç°å®Œæ•´çš„äººç‰©ä¿®ä»™åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¿®ç‚¼ã€çªç ´ã€å±æ€§æˆé•¿ç­‰æ ¸å¿ƒæœºåˆ¶

**å¿…é¡»å®ç°çš„åŠŸèƒ½**:

1. **å®Œå–„äººç‰©å±æ€§ç³»ç»Ÿ**
   - âœ… åŸºç¡€å±æ€§ç»“æ„å·²å®ç°
   - âœ… äº”è¡Œäº²å’Œåº¦ç³»ç»Ÿå·²å®ç°
   - âœ… ä¿®ç‚¼å€¼å’Œå¢ƒç•Œç³»ç»Ÿå·²å®ç°
   - ğŸ”„ éœ€è¦å®Œå–„è´§å¸ç³»ç»Ÿï¼ˆçµçŸ³åˆ†çº§ï¼‰
   - ğŸ”„ éœ€è¦å®ç°å¤´è¡”ç³»ç»Ÿå®Œæ•´é€»è¾‘

2. **ä¿®ç‚¼ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½**
   - âœ… åŸºç¡€ä¿®ç‚¼åŠŸèƒ½å·²å®ç°
   - âœ… çªç ´æœºåˆ¶å·²å®ç°
   - ğŸ”„ éœ€è¦å®ç°å¢ƒç•Œé˜¶æ®µè¯¦ç»†åˆ’åˆ†
   - ğŸ”„ éœ€è¦å®ç°ä¿®ç‚¼é€Ÿåº¦åŠ æˆè®¡ç®—
   - ğŸ”„ éœ€è¦å®ç°é¡¿æ‚Ÿæœºåˆ¶

3. **æ•°æ®æŒä¹…åŒ–**
   - âœ… JSONæ•°æ®ç»“æ„å·²è®¾è®¡
   - ğŸ”„ éœ€è¦å®ç°æ•°æ®ä¿å­˜/åŠ è½½åŠŸèƒ½
   - ğŸ”„ éœ€è¦å®ç°å¤šè§’è‰²ç®¡ç†

4. **ç”¨æˆ·ç•Œé¢ä¼˜åŒ–**
   - âœ… åŸºç¡€äººç‰©é¢æ¿å·²å®ç°
   - ğŸ”„ éœ€è¦æ·»åŠ ä¿®ç‚¼è¿›åº¦å¯è§†åŒ–
   - ğŸ”„ éœ€è¦å®ç°ä¿®ç‚¼æ—¥å¿—ç³»ç»Ÿ
   - ğŸ”„ éœ€è¦æ·»åŠ å¢ƒç•Œçªç ´åŠ¨ç”»æ•ˆæœ

**æŠ€æœ¯å®ç°è¦ç‚¹**:

- ä¿®ç‚¼å€¼è®¡ç®—å…¬å¼ï¼šåŸºç¡€å¢é•¿ Ã— (1 + ä¿®ç‚¼é€Ÿåº¦åŠ æˆ/100) Ã— ä½“è´¨åŠ æˆ
- çªç ´æˆåŠŸç‡ï¼šåŸºç¡€æˆåŠŸç‡ Ã— çµé­‚å¼ºåº¦ç³»æ•° Ã— ç‰©å“åŠ æˆ
- å¢ƒç•Œé˜¶æ®µæ˜ å°„ï¼šæ ¹æ®ä¿®ç‚¼å€¼èŒƒå›´è‡ªåŠ¨åˆ¤å®šå½“å‰å¢ƒç•Œ
- å±æ€§è”åŠ¨ï¼šäº”è¡Œäº²å’Œåº¦å½±å“å¯¹åº”åŠŸæ³•æ•ˆæœ

### Stage Two: åŠŸæ³•ä¸æˆ˜æ–—ç³»ç»Ÿ

**ç›®æ ‡**: å®ç°åŠŸæ³•å­¦ä¹ ã€è£…å¤‡ã€æˆ˜æ–—è®¡ç®—ç­‰ç³»ç»Ÿ

**ä¸»è¦åŠŸèƒ½**:
- åŠŸæ³•åˆ†ç±»ç³»ç»Ÿï¼ˆå¿ƒæ³•ã€åŠŸæ³•ã€æ­¦æŠ€ã€ç§˜æœ¯ï¼‰
- åŠŸæ³•å­¦ä¹ æ¡ä»¶åˆ¤å®š
- åŠŸæ³•è£…å¤‡ä¸åˆ‡æ¢æœºåˆ¶
- åŸºç¡€æˆ˜æ–—åŠ›è®¡ç®—
- åŠŸæ³•ç»„åˆæ•ˆæœ

### Stage Three: å®—é—¨ä¸ç¤¾äº¤ç³»ç»Ÿ

**ç›®æ ‡**: å®ç°å®—é—¨ç®¡ç†ã€æˆå‘˜äº’åŠ¨ã€å®—é—¨ä»»åŠ¡ç­‰åŠŸèƒ½

**ä¸»è¦åŠŸèƒ½**:
- å®—é—¨åˆ›å»ºä¸åŠ å…¥
- å®—é—¨ç­‰çº§ä¸èµ„æºç®¡ç†
- å®—é—¨è´¡çŒ®ç‚¹ç³»ç»Ÿ
- å®—é—¨ä»»åŠ¡ä¸å¥–åŠ±
- æˆå‘˜æƒé™ç®¡ç†

### Stage Four: è£…å¤‡ä¸ç‰©å“ç³»ç»Ÿ

**ç›®æ ‡**: å®ç°æ­¦å™¨è£…å¤‡ã€ç‰©å“ç‚¼åˆ¶ã€äº¤æ˜“ç­‰åŠŸèƒ½

**ä¸»è¦åŠŸèƒ½**:
- æ­¦å™¨å±æ€§ä¸å“è´¨ç³»ç»Ÿ
- è£…å¤‡å¼ºåŒ–ä¸é•¶åµŒ
- ç‚¼ä¸¹ç³»ç»Ÿå®ç°
- ç‰©å“äº¤æ˜“å¸‚åœº
- èƒŒåŒ…ç®¡ç†ç³»ç»Ÿ

### Stage Five: é«˜çº§ç©æ³•ä¸ä¼˜åŒ–

**ç›®æ ‡**: å®ç°PVPã€å‰¯æœ¬ã€æ’è¡Œæ¦œç­‰é«˜çº§åŠŸèƒ½

**ä¸»è¦åŠŸèƒ½**:
- PVPæˆ˜æ–—ç³»ç»Ÿ
- å‰¯æœ¬ä¸æŒ‘æˆ˜
- æ’è¡Œæ¦œç³»ç»Ÿ
- æˆå°±ç³»ç»Ÿ
- æ€§èƒ½ä¼˜åŒ–

## Stage One è¯¦ç»†å®ç°è®¡åˆ’

### 1. ä¿®ç‚¼ç³»ç»Ÿå¢å¼º

**1.1 å¢ƒç•Œç³»ç»Ÿå®Œå–„**
```typescript
// å¢ƒç•Œé…ç½®æ•°æ®
interface CultivationStage {
  id: string;
  name: string;
  phase: 'mortal' | 'cultivator' | 'immortal';
  level: number;
  minCultivation: number;
  maxCultivation: number;
  breakthroughRequirements: {
    soulStrength: number;
    items?: string[];
    tasks?: string[];
  };
  bonuses: {
    baseAttributes: number; // åŸºç¡€å±æ€§åŠ æˆç™¾åˆ†æ¯”
    skillPoints?: number;   // æŠ€èƒ½ç‚¹å¥–åŠ±
  };
}
```

**1.2 ä¿®ç‚¼é€Ÿåº¦è®¡ç®—**
```typescript
// ä¿®ç‚¼é€Ÿåº¦è®¡ç®—å‡½æ•°
function calculateCultivationSpeed(character: Character): number {
  const baseSpeed = 100; // åŸºç¡€ä¿®ç‚¼é€Ÿåº¦
  const physiqueBonus = Math.floor(character.physique / 20) * 10; // ä½“è´¨åŠ æˆ
  const affinityBonus = getHighestAffinity(character.affinity) * 0.5; // äº²å’Œåº¦åŠ æˆ
  const titleBonus = character.title?.cultivationSpeedBonus || 0; // å¤´è¡”åŠ æˆ
  
  return baseSpeed + physiqueBonus + affinityBonus + titleBonus;
}
```

**1.3 é¡¿æ‚Ÿæœºåˆ¶**
```typescript
// é¡¿æ‚Ÿè§¦å‘æ£€æŸ¥
function checkEnlightenment(character: Character): boolean {
  const progress = character.cultivation / character.expToNextLevel;
  if (progress >= 0.9 && Math.random() < 0.1) {
    // è§¦å‘é¡¿æ‚Ÿï¼Œä¿®ç‚¼é€Ÿåº¦+50%ï¼ŒæŒç»­24å°æ—¶
    return true;
  }
  return false;
}
```

### 2. æ•°æ®ç®¡ç†ç³»ç»Ÿ

**2.1 æ•°æ®æœåŠ¡å±‚**
```typescript
// æ•°æ®ç®¡ç†æœåŠ¡
class CharacterDataService {
  private static readonly STORAGE_KEY = 'cultivation_game_data';
  
  static saveCharacter(character: Character): void {
    const existingData = this.loadAllCharacters();
    const index = existingData.findIndex(c => c.id === character.id);
    
    if (index >= 0) {
      existingData[index] = character;
    } else {
      existingData.push(character);
    }
    
    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(existingData));
  }
  
  static loadCharacter(id: string): Character | null {
    const allCharacters = this.loadAllCharacters();
    return allCharacters.find(c => c.id === id) || null;
  }
  
  static loadAllCharacters(): Character[] {
    const data = localStorage.getItem(this.STORAGE_KEY);
    return data ? JSON.parse(data) : [];
  }
}
```

### 3. UIç»„ä»¶å¢å¼º

**3.1 ä¿®ç‚¼è¿›åº¦ç»„ä»¶**
```typescript
// ä¿®ç‚¼è¿›åº¦å¯è§†åŒ–ç»„ä»¶
const CultivationProgress: React.FC<{ character: Character }> = ({ character }) => {
  const progress = (character.cultivation / character.expToNextLevel) * 100;
  const nextStage = getNextCultivationStage(character.cultivationStage);
  
  return (
    <div className={styles.cultivationProgress}>
      <div className={styles.progressBar}>
        <div 
          className={styles.progressFill} 
          style={{ width: `${progress}%` }}
        />
      </div>
      <div className={styles.progressText}>
        {character.cultivationStage} â†’ {nextStage}
      </div>
      <div className={styles.progressNumbers}>
        {character.cultivation.toLocaleString()} / {character.expToNextLevel.toLocaleString()}
      </div>
    </div>
  );
};
```

**3.2 ä¿®ç‚¼æ—¥å¿—ç»„ä»¶**
```typescript
// ä¿®ç‚¼æ—¥å¿—ç³»ç»Ÿ
interface CultivationLog {
  id: string;
  timestamp: Date;
  type: 'cultivate' | 'breakthrough_success' | 'breakthrough_failure' | 'enlightenment';
  message: string;
  gains?: {
    cultivation?: number;
    attributes?: Partial<CharacterBaseAttributes>;
  };
}

const CultivationLogPanel: React.FC = () => {
  const [logs, setLogs] = useState<CultivationLog[]>([]);
  
  return (
    <div className={styles.logPanel}>
      <h4>ä¿®ç‚¼æ—¥å¿—</h4>
      <div className={styles.logList}>
        {logs.map(log => (
          <div key={log.id} className={styles.logItem}>
            <span className={styles.timestamp}>
              {log.timestamp.toLocaleTimeString()}
            </span>
            <span className={styles.message}>{log.message}</span>
          </div>
        ))}
      </div>
    </div>
  );
};
```

## æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **React 18**: ç”¨æˆ·ç•Œé¢æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨çš„JavaScript
- **Sass/SCSS**: CSSé¢„å¤„ç†å™¨
- **Vite**: æ„å»ºå·¥å…·
- **Context API**: çŠ¶æ€ç®¡ç†

### æ•°æ®å­˜å‚¨
- **JSONæ–‡ä»¶**: è§’è‰²æ•°æ®å­˜å‚¨
- **LocalStorage**: å®¢æˆ·ç«¯æ•°æ®æŒä¹…åŒ–
- **æœªæ¥æ‰©å±•**: å¯æ¥å…¥åç«¯API

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ components/          # Reactç»„ä»¶
â”‚   â”œâ”€â”€ CharacterPanel/  # äººç‰©é¢æ¿
â”‚   â”œâ”€â”€ CultivationPanel/ # ä¿®ç‚¼é¢æ¿
â”‚   â””â”€â”€ Common/          # é€šç”¨ç»„ä»¶
â”œâ”€â”€ contexts/            # React Context
â”‚   â”œâ”€â”€ CharacterContext.tsx
â”‚   â””â”€â”€ GameContext.tsx
â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ Character.ts
â”‚   â”œâ”€â”€ Cultivation.ts
â”‚   â””â”€â”€ Game.ts
â”œâ”€â”€ data/                # é™æ€æ•°æ®
â”‚   â”œâ”€â”€ characters.json
â”‚   â”œâ”€â”€ cultivationStages.json
â”‚   â””â”€â”€ gameConfig.json
â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ CharacterService.ts
â”‚   â”œâ”€â”€ CultivationService.ts
â”‚   â””â”€â”€ DataService.ts
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ calculations.ts
â”‚   â”œâ”€â”€ formatters.ts
â”‚   â””â”€â”€ validators.ts
â””â”€â”€ styles/              # æ ·å¼æ–‡ä»¶
    â”œâ”€â”€ globals.scss
    â”œâ”€â”€ variables.scss
    â””â”€â”€ mixins.scss
```

## å¼€å‘ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (Stage One å¿…é¡»å®Œæˆ)
1. âœ… åŸºç¡€ä¿®ç‚¼åŠŸèƒ½
2. âœ… çªç ´æœºåˆ¶
3. ğŸ”„ å¢ƒç•Œç³»ç»Ÿå®Œå–„
4. ğŸ”„ æ•°æ®æŒä¹…åŒ–
5. ğŸ”„ UIä¼˜åŒ–

### ä¸­ä¼˜å…ˆçº§ (Stage One å¯é€‰)
1. é¡¿æ‚Ÿæœºåˆ¶
2. ä¿®ç‚¼æ—¥å¿—
3. å¤šè§’è‰²ç®¡ç†
4. å±æ€§åŠ ç‚¹ç³»ç»Ÿ

### ä½ä¼˜å…ˆçº§ (åç»­é˜¶æ®µ)
1. åŠŸæ³•ç³»ç»Ÿ
2. å®—é—¨ç³»ç»Ÿ
3. è£…å¤‡ç³»ç»Ÿ
4. PVPç³»ç»Ÿ

## æ€»ç»“

å½“å‰é¡¹ç›®å·²ç»å…·å¤‡äº†è‰¯å¥½çš„åŸºç¡€æ¶æ„ï¼ŒStage Oneçš„æ ¸å¿ƒä¿®ä»™åŠŸèƒ½åŸºæœ¬å®ç°ã€‚æ¥ä¸‹æ¥éœ€è¦é‡ç‚¹å®Œå–„å¢ƒç•Œç³»ç»Ÿçš„è¯¦ç»†åˆ’åˆ†ã€æ•°æ®æŒä¹…åŒ–æœºåˆ¶ï¼Œä»¥åŠç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–ã€‚é€šè¿‡åˆ†é˜¶æ®µå¼€å‘ï¼Œå¯ä»¥ç¡®ä¿æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½å¾—åˆ°å……åˆ†çš„æµ‹è¯•å’Œä¼˜åŒ–ï¼Œä¸ºåç»­çš„åŠŸèƒ½æ‰©å±•æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚